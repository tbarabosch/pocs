#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <fcntl.h>
#include <ucontext.h>
#include <sys/syscall.h>

#define GETCONTEXT 421

int main()
{
        printf("Sizeof ucontext_t is %lu bytes.\n", sizeof(ucontext_t));
        ucontext_t *ucp = malloc(sizeof(ucontext_t));
        memset(ucp, 0x42, sizeof(ucontext_t));

        syscall(GETCONTEXT, ucp);

        FILE *ptr;
        ptr = fopen("ucp_dump.bin","wb");
        if (ptr == NULL){
                printf("Error while opening file.\n");
                exit(1);
        }

        fwrite(ucp, sizeof(ucontext_t), 1, ptr);

        fclose(ptr);
        free(ucp);

        return 0;
}
